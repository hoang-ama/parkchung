<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Bookings - ParkChung</title>
    <link rel="icon" type="image/png" href="../assets/logo/favicon.png" />
    <link rel="stylesheet" href="css/styles.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
</head>
<body>
    <header>
        <div class="logo">
             <a href="index.html" style="display: flex; align-items: center; text-decoration: none; color: inherit;">
                <img src="../assets/logo/logo.svg" alt="Parkchung Logo" />
                <div>
                    <h1>PARKCHUNG</h1>
                    <p class="tagline">Save time. Save money. Save Earth</p>
                </div>
            </a>
        </div>
        <nav>
            </nav>
    </header>

    <main class="bookings-main">
        <div class="bookings-header">
            <h2>My Bookings</h2>
            <a href="index.html" class="nav-button home-button">‚Üê Back to Home</a>
        </div>
        
        <div id="bookings-container">
            <p>Loading your bookings...</p>
        </div>
    </main>

    <script type="module" src="js/app.js"></script>
    <script type="module">
        import { api } from './js/apiService.js';

        document.addEventListener('DOMContentLoaded', async () => {
            const container = document.getElementById('bookings-container');
            if (!localStorage.getItem('userToken')) {
                container.innerHTML = '<p class="no-bookings-message">Please <a href="login.html">log in</a> to see your bookings.</p>';
                return;
            }
            try {
                const bookings = await api.getMyBookings();
                
                if (bookings.length === 0) {
                    container.innerHTML = "<p class='no-bookings-message'>You don't have any bookings yet.</p>";
                    return;
                }
                
                let html = '';
                const options = { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' };
                
                bookings.forEach(b => {
                    html += `
                    <div class="booking-card">
                        <div class="booking-card__icon">
                            <i class="fas fa-parking"></i>
                        </div>
                        <div class="booking-card__details">
                            <h3>${b.spot ? b.spot.address : 'Spot Not Found'}</h3>
                            <p><strong>From:</strong> ${new Date(b.startTime).toLocaleString('vi-VN', options)}</p>
                            <p><strong>To:</strong> ${new Date(b.endTime).toLocaleString('vi-VN', options)}</p>
                            <p><strong>Status:</strong> <span class="booking-status status-${b.status}">${b.status}</span></p>
                        </div>
                    </div>
                    `;
                });
                
                container.innerHTML = html;
            } catch (error) {
                container.innerHTML = `<p class="no-bookings-message" style="color: red;">Error: ${error.message}</p>`;
            }
        });
    </script>
</body>
</html>